Group {
 name LightMixer
 knobChanged "\nn = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name().endswith(\"_solo\"):\n    val = k.getValue()\n    if val == 1:\n        for kn in n.knobs():\n            if kn.endswith(\"_solo\") and kn!=k.name():\n                n\[kn].setValue(0)\n    aov_name = k.name().rsplit(\"_\", 1)\[0]\n    n.begin()\n    solo_sw = nuke.toNode(\"solo_switch\")\n    solo_sw.setInput(1, nuke.toNode(\"\{\}_mult\".format(aov_name)))\n    solo_sw\[\"which\"].setValue(val)\n    n.end()\nif k.name().endswith(\"_dis\"):\n    aov_name = k.name().rsplit(\"_\", 1)\[0]\n    val = k.getValue()\n    \[n\[kn].setEnabled(val==0) for kn in n.knobs() if kn.startswith(aov_name) and kn.rsplit(\"_\", 1)\[1] not in \[\"solo\", \"mute\", \"dis\", \"inject\", \"del\", \"about\"]]"
 tile_color 0x8535d5ff
 lock_connections true
 addUserKnob {20 LightMixer l "Light Mixer"}
 addUserKnob {22 add_aov l "select AOV" -STARTLINE T "node = nuke.thisNode()\n\nexclusuin_list = \[\"depth\", \"rgb\", \"rgba\", \"alpha\"]\naov_list = set(\[c.split(\".\")\[0] for c in node.channels() if not c.split(\".\")\[0] in exclusuin_list])\naov_list = sorted(\[c for c in aov_list if not \"crypto\" in c.lower()])\n\ndef autoBackdrop(selNodes=None):\n    if not selNodes:\n        selNodes = nuke.selectedNodes()\n    if not selNodes:\n        return nuke.nodes.BackdropNode()\n\n    for nde in selNodes:\n        x = nde\['xpos'].value()\n        y = nde\['ypos'].value()\n        nde\['xpos'].setValue(x)\n        nde\['ypos'].setValue(y)\n\n    bdX = min(\[nde.xpos() for nde in selNodes])\n    bdY = min(\[nde.ypos() for nde in selNodes])\n    bdW = max(\[nde.xpos() + nde.screenWidth() for nde in selNodes]) - bdX\n    bdH = max(\[nde.ypos() + nde.screenHeight() for nde in selNodes]) - bdY\n\n    margin = 100\n    left, top, right, bottom = (-margin, -margin, margin, margin)\n    bdX += left\n    bdY += top\n    bdW += (right - left)\n    bdH += (bottom - top)\n\n    n = nuke.nodes.BackdropNode(xpos = bdX,\n                                bdwidth = bdW,\n                                ypos = bdY,\n                                bdheight = bdH,\n                                tile_color = 1244014335,\n                                z_order = -10 )\n\n    nuke.zoomToFitSelected()\n\n    n\['selected'].setValue(False)\n    return n\n\nclass ChooseAov(nukescripts.PythonPanel):\n    def __init__(self):\n        super(ChooseAov, self).__init__('Select AOV')\n        self.setMinimumSize(300, 80)\n        self.aov_name = nuke.Enumeration_Knob(\"aov_name\", \"AOV Name: \", \[\"_SEARCH_\"]+aov_list)\n        self.artistic_control = nuke.Boolean_Knob(\"artistic\", \"Artistic Control\")\n        self.artistic_control.clearFlag(nuke.STARTLINE)\n        self.addKnob(self.aov_name)\n        self.addKnob(self.artistic_control)\n\n        self.addKnob(nuke.Text_Knob(\"div\", \"\"))\n        self.search_where = nuke.Radio_Knob(\"search_where\", \"\", (\"starts\", \"ends\", \"contains\"))\n        self.search_where.setFlag(nuke.STARTLINE)\n        self.addKnob(self.search_where)\n\n        self.search_for = nuke.String_Knob(\"search_for\", \"\", \"lgt_\")\n        self.addKnob(self.search_for)\n        self.search_for.clearFlag(nuke.STARTLINE)\n        self.div = nuke.Text_Knob(\"div1\", \"\")\n        self.addKnob(self.div)\n\n    def knobChanged(self, knob):\n        if knob.name() == \"aov_name\":\n            value = knob.value() == \"_SEARCH_\"\n            self.search_where.setVisible(value)\n            self.search_for.setVisible(value)\n            self.div.setVisible(value)\n\npanel = ChooseAov()\nif panel.showModalDialog():\n    name = panel.aov_name.value()\n    artistic = panel.artistic_control.value()\n    if name == \"_SEARCH_\":\n        search_where = panel.search_where.value()\n        search_for = panel.search_for.value().lower()\n        if search_where == \"starts\":\n            aov_names = \[l for l in aov_list if l.lower().startswith(search_for)]\n        elif search_where == \"ends\":\n            aov_names = \[l for l in aov_list if l.lower().endswith(search_for)]\n        elif search_where == \"contains\":\n            aov_names = \[l for l in aov_list if search_for in l.lower()]\n        else:\n            aov_names = \[]\n    else:\n        aov_names = \[name]\n    for aov_name in aov_names:\n        if not node.knob(aov_name+\"_tex\"):\n            for _, cl in node.knobs().items():\n                if isinstance(cl, nuke.Link_Knob) and cl.name()==\"mix\":\n                    node.removeKnob(cl)\n            node.removeKnob(node.knob(\"mix_div\"))\n            node.removeKnob(node.knob(\"credit\"))\n            node.addKnob(nuke.Text_Knob(aov_name+\"_tex\", \"\",  '<font size=4 color=\"orange\">\{\}</font>\\n'.format(aov_name)))\n\n            knob = nuke.String_Knob(aov_name+\"_about\", \"\")\n            knob.clearFlag(nuke.STARTLINE)\n            node.addKnob(knob)\n            \n            knob = nuke.Boolean_Knob(aov_name + \"_solo\", \"<font color=\\\"green\\\"><b>\[S]</b></font>\")\n            node.addKnob(knob)\n            knob.setFlag(nuke.STARTLINE)\n            \n            knob = nuke.Boolean_Knob(aov_name + \"_mute\", \"<font color=\\\"red\\\"><b>\[M]</b></font>\")\n            node.addKnob(knob)\n            knob.clearFlag(nuke.STARTLINE)\n\n            knob = nuke.Boolean_Knob(aov_name + \"_dis\", \"<font color=\\\"orange\\\"><b>\[D]</b></font>\")\n            node.addKnob(knob)\n            knob.clearFlag(nuke.STARTLINE)\n            \n            knob = nuke.Boolean_Knob(aov_name + \"_inject\", \"inject\")\n            knob.setValue(1)\n            node.addKnob(knob)\n            knob.clearFlag(nuke.STARTLINE)\n\n            knob_script = \"\"\"\nnode = nuke.thisNode()\nknob = nuke.thisKnob()\n\nnn = knob.name().rsplit(\"_\", 1)\[0]\nnode.begin()\nbdrp = nuke.toNode(\"__\{\}__\".format(nn))\nif bdrp:\n    \[nuke.delete(n) for n in bdrp.getNodes()+\[bdrp]]\nnode.end()\n\[node.removeKnob(node\[k]) for k in node.knobs() if k.startswith(nn)]\n        \"\"\"\n            knob = nuke.PyScript_Knob(aov_name + \"_del\", \"X\", knob_script)\n            node.addKnob(knob)\n            knob.clearFlag(nuke.STARTLINE)\n\n            knob = nuke.Color_Knob(aov_name + \"_col\", \"Color\")\n            knob.setValue(1)\n            knob.setSingleValue(False)\n            node.addKnob(knob)\n            \n            if not artistic:\n                knob = nuke.Double_Knob(aov_name + \"_intens\", \"Intensity\")\n                knob.setValue(1)\n                knob.setRange(0, 5)\n                node.addKnob(knob)\n            \n            knob = nuke.Double_Knob(aov_name + \"_expo\", \"Exposure\")\n            knob.setValue(0)\n            knob.setRange(-5, 5)\n            node.addKnob(knob)\n\n            if artistic:\n                knob = nuke.Double_Knob(aov_name + \"_gam\", \"Gamma\")\n                knob.setValue(1)\n                knob.setRange(0.2, 5)\n                node.addKnob(knob)\n\n                knob = nuke.Double_Knob(aov_name + \"_sat\", \"Saturation\")\n                knob.setValue(1)\n                knob.setRange(0, 1)\n                node.addKnob(knob)\n\n            knob = nuke.Text_Knob(aov_name + \"_div\", \"\")\n            node.addKnob(knob)\n\n            knob = nuke.Link_Knob(\"mix\", \"mix\")\n            knob.setLink(\"merge_mask.mix\")\n            node.addKnob(knob)\n\n            knob = nuke.Text_Knob(\"mix_div\", \"\")\n            node.addKnob(knob)\n\n            knob = nuke.Text_Knob(\"credit\",\"\", '<font><br/><b><a href=\"https://linktr.ee/har8unyan\" style=\"color:#666\">Harut Harutyunyan</a></b></font>')\n            node.addKnob(knob)\n\n            node.begin()\n            output = nuke.toNode(\"Output1\")\n            merge_mask = nuke.toNode(\"merge_mask\")\n            mask = nuke.toNode(\"mask\")\n            solo_sw = nuke.toNode(\"solo_switch\")\n            inpt  = solo_sw.input(0)\n            shuffle = nuke.nodes.Shuffle()\n            shuffle\[\"in\"].setValue(aov_name)\n            shuffle.setInput(0, inpt)\n            shuffle.setXYpos(inpt.xpos()-150, inpt.ypos()+220)\n            m_from = nuke.nodes.Merge2(operation=\"from\", output=\"rgb\", bbox=\"B\")\n            m_from.setInput(0, inpt)\n            m_from.setInput(1, shuffle)\n            m_from.setXYpos(inpt.xpos(), shuffle.ypos())\n            m_plus = nuke.nodes.Merge2(operation=\"plus\", output=\"rgb\", bbox=\"B\")\n            shuffle_copy = nuke.nodes.ShuffleCopy(out = aov_name)\n            shuffle_copy\[\"in\"].setValue(\"rgb\")\n            shuffle_copy\[\"red\"].setValue(\"red\")\n            shuffle_copy\[\"green\"].setValue(\"green\")\n            shuffle_copy\[\"blue\"].setValue(\"blue\")\n            shuffle_copy\[\"alpha\"].setValue(\"black\")\n            shuffle_copy.setInput(0, m_from)\n            shuffle_copy.setXYpos(inpt.xpos(), m_from.ypos()+100)\n            shuffle_copy\[\"disable\"].setExpression(\"1-\{\}_inject\".format(aov_name))\n            m_plus.setInput(0, shuffle_copy)\n            m_plus.setXYpos(inpt.xpos(), m_from.ypos()+130)\n            m_plus\[\"disable\"].setExpression(\"\{\}_mute\".format(aov_name))\n            solo_sw.setInput(0, m_plus)\n            solo_sw.setXYpos(inpt.xpos()+150, m_plus.ypos()+220)\n            merge_mask.setXYpos(solo_sw.xpos(), m_plus.ypos()+250)\n            mask.setXYpos(solo_sw.xpos()+150, m_plus.ypos()+250)\n            output.setXYpos(inpt.xpos(), m_plus.ypos()+280)\n            if artistic:\n                color_n = nuke.nodes.Grade()\n                color_n\[\"white\"].setSingleValue(False)\n                color_n\[\"white\"].setExpression(expression=\"parent.\{\}_col.r\".format(aov_name), channel=0)\n                color_n\[\"white\"].setExpression(expression=\"parent.\{\}_col.g\".format(aov_name), channel=1)\n                color_n\[\"white\"].setExpression(expression=\"parent.\{\}_col.b\".format(aov_name), channel=2)\n                color_n\[\"multiply\"].setExpression(\"pow(2, \{\}_expo)\".format(aov_name))\n                color_n\[\"gamma\"].setExpression(\"\{\}_gam\".format(aov_name))\n                color_n.setInput(0, shuffle)\n                color_n.setXYpos(shuffle.xpos(), shuffle.ypos()+50)\n                mult_n = nuke.nodes.Saturation()\n                mult_n.setName(\"\{\}_mult\".format(aov_name))\n                mult_n\[\"saturation\"].setExpression(\"\{\}_sat\".format(aov_name))\n                mult_n.setInput(0, color_n)\n                mult_n.setXYpos(color_n.xpos(), color_n.ypos()+50)\n            else:\n                color_n = nuke.nodes.Multiply(channels = \"rgb\")\n                color_n\[\"value\"].setSingleValue(False)\n                color_n.setName(\"color\")\n                color_n\[\"value\"].setExpression(expression=\"parent.\{\}_col.r\".format(aov_name), channel=0)\n                color_n\[\"value\"].setExpression(expression=\"parent.\{\}_col.g\".format(aov_name), channel=1)\n                color_n\[\"value\"].setExpression(expression=\"parent.\{\}_col.b\".format(aov_name), channel=2)\n                color_n.setInput(0, shuffle)\n                color_n.setXYpos(shuffle.xpos(), shuffle.ypos()+50)\n                mult_n = nuke.nodes.Multiply(channels = \"rgb\")\n                mult_n.setName(\"\{\}_mult\".format(aov_name))\n                mult_n\[\"value\"].setExpression(\"pow(2, \{0\}_expo) * \{0\}_intens\".format(aov_name))\n                mult_n.setInput(0, color_n)\n                mult_n.setXYpos(color_n.xpos(), color_n.ypos()+50)\n\n            color_n\[\"disable\"].setExpression(\"\{\}_dis\".format(aov_name))\n            mult_n\[\"disable\"].setExpression(\"\{\}_dis\".format(aov_name))\n            shuffle_copy.setInput(1, mult_n)\n            m_plus.setInput(1, mult_n)\n            bdrp = autoBackdrop(\[shuffle, m_from, m_plus])\n            bdrp.setName(\"__\{\}__\".format(aov_name))\n            node.end()"}
 addUserKnob {22 clear_all l "clear all" -STARTLINE T "node = nuke.thisNode()\nfor k in node.knobs():\n    if k.endswith(\"_del\"):\n        knob = node\[k]\n        knob.execute()"}
 addUserKnob {26 ""}
 addUserKnob {41 mix T merge_mask.mix}
 addUserKnob {26 mix_div l "" +STARTLINE}
 addUserKnob {26 credit l "" t "© Harut Harutyunyan\nhar8unyan@gmail.com\n2022" +STARTLINE T "<font><br/><b><a href=\"https://linktr.ee/har8unyan\" style=\"color:#666\">Harut Harutyunyan</a></b></font>"}
}
 Input {
  inputs 0
  name mask
  xpos 224
  ypos 4341
  number 1
 }
 Input {
  inputs 0
  name Input
  xpos -76
  ypos 4218
 }
set Ne9381800 [stack 0]
push $Ne9381800
 Switch {
  inputs 2
  name solo_switch
  xpos 74
  ypos 4311
 }
push $Ne9381800
 Merge2 {
  inputs 2+1
  operation copy
  also_merge all
  name merge_mask
  xpos 74
  ypos 4341
 }
 Output {
  name Output1
  xpos -76
  ypos 4371
 }
end_group
